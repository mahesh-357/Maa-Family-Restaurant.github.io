<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management - Maa family Restuarant Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Noto+Sans+Telugu:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --teal: #2CA58D;
            --teal-dark: #1F7F6D;
            --maroon: var(--teal);
            --maroon-dark: var(--teal-dark);
            --gold: #D4AF37;
            --gold-light: #E8C547;
            --cream: #E6F4F1;
            --cream-dark: #CFEAE4;
            --dark-green: #1B4332;
            --dark-green-light: #2D6A4F;
        }

        * { font-family: 'Poppins', 'Noto Sans Telugu', sans-serif; }
        .telugu-text { font-family: 'Noto Sans Telugu', sans-serif; }

        body {
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            min-height: 100vh;
        }

        /* Menu Card */
        .menu-card {
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(44, 165, 141, 0.3);
        }

        /* Action Buttons */
        .action-btn {
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px) scale(1.1);
        }

        /* Modal */
        .modal-overlay {
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: modalSlide 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Toast Notification */
        .toast {
            animation: toastSlide 0.4s ease, toastFade 0.4s ease 2.6s forwards;
        }

        @keyframes toastSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes toastFade {
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--cream); }
        ::-webkit-scrollbar-thumb { background: var(--teal); border-radius: 4px; }

        /* Category Badge */
        .category-soups { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; }
        .category-starters { background: linear-gradient(135deg, #f87171, #ef4444); color: white; }
        .category-biryanis { background: linear-gradient(135deg, #a78bfa, #8b5cf6); color: white; }
        .category-curries { background: linear-gradient(135deg, #fb923c, #f97316); color: white; }
        .category-desserts { background: linear-gradient(135deg, #f472b6, #ec4899); color: white; }
        .category-beverages { background: linear-gradient(135deg, #60a5fa, #3b82f6); color: white; }
    </style>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="bg-gradient-to-r from-[#2CA58D] to-[#1F7F6D] text-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="admin-dashboard.html" class="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </a>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-[#D4AF37] flex items-center justify-center">
                            <span class="text-[#2CA58D] text-lg font-bold telugu-text">‡∞Ö</span>
                        </div>
                        <div>
                            <h1 class="font-bold text-lg">Menu Management</h1>
                            <p class="text-white/70 text-xs">Alanati Telugu Kitchen</p>
                        </div>
                    </div>
                </div>
                <button onclick="openAddModal()" class="flex items-center gap-2 bg-[#D4AF37] text-[#2CA58D] px-4 py-2 rounded-xl font-semibold hover:bg-[#E8C547] transition-colors">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    Add Item
                </button>
            </div>
        </div>
    </header>

    <!-- ============================================
         CATEGORY TABS
         ============================================ -->
    <div class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-2 overflow-x-auto py-4">
                <button onclick="filterCategory('all')" class="category-btn active whitespace-nowrap px-4 py-2 rounded-lg bg-[#2CA58D] text-white font-medium text-sm" data-category="all">
                    All Items
                </button>
                <button onclick="filterCategory('soups')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="soups">
                    üç≤ Soups
                </button>
                <button onclick="filterCategory('starters')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="starters">
                    üçó Starters
                </button>
                <button onclick="filterCategory('biryanis')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="biryanis">
                    üçö Biryanis
                </button>
                <button onclick="filterCategory('curries')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="curries">
                    üçõ Curries
                </button>
                <button onclick="filterCategory('desserts')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="desserts">
                    üç® Desserts
                </button>
                <button onclick="filterCategory('beverages')" class="category-btn whitespace-nowrap px-4 py-2 rounded-lg bg-gray-100 text-gray-600 font-medium text-sm" data-category="beverages">
                    ü•§ Beverages
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-2xl p-4 shadow-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-[#2CA58D]/10 flex items-center justify-center">
                        <i data-lucide="utensils" class="w-5 h-5 text-[#2CA58D]"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-[#2CA58D]" id="totalItems">0</p>
                        <p class="text-xs text-gray-500">Total Items</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-green-600" id="availableItems">0</p>
                        <p class="text-xs text-gray-500">Available</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-[#1B4332]/10 flex items-center justify-center">
                        <i data-lucide="leaf" class="w-5 h-5 text-[#1B4332]"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-[#1B4332]" id="vegItems">0</p>
                        <p class="text-xs text-gray-500">Veg Items</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center">
                        <i data-lucide="drumstick" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-red-600" id="nonVegItems">0</p>
                        <p class="text-xs text-gray-500">Non-Veg</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Grid -->
        <div id="menuGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="col-span-full text-center py-16 text-gray-500">
                <i data-lucide="loader-2" class="w-12 h-12 mx-auto mb-4 animate-spin text-[#2CA58D]"></i>
                <p>Loading menu items...</p>
            </div>
        </div>
    </main>

    <!-- ============================================
         ADD/EDIT MODAL
         ============================================ -->
    <div id="menuModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0 bg-black/60 flex items-center justify-center p-4" onclick="closeModal()">
            <div class="modal-content bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                    <h3 class="text-xl font-bold text-[#2CA58D]" id="modalTitle">Add Menu Item</h3>
                    <button onclick="closeModal()" class="p-2 rounded-full bg-gray-100 hover:bg-gray-200">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <form id="menuForm" onsubmit="saveItem(event)" class="p-6 space-y-4">
                    <input type="hidden" id="itemId">
                    
                    <!-- Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Item Name *</label>
                        <input type="text" id="itemName" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none" placeholder="e.g. Chicken Biryani">
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="itemDescription" rows="2" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none resize-none" placeholder="Brief description of the dish"></textarea>
                    </div>

                    <!-- Price & Category -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Price (‚Çπ) *</label>
                            <input type="number" id="itemPrice" required min="1" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none" placeholder="299">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                            <select id="itemCategory" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none">
                                <option value="">Select</option>
                                <option value="soups">Soups</option>
                                <option value="starters">Starters</option>
                                <option value="biryanis">Biryanis</option>
                                <option value="curries">Curries</option>
                                <option value="desserts">Desserts</option>
                                <option value="beverages">Beverages</option>
                            </select>
                        </div>
                    </div>

                    <!-- Image URL -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                        <input type="url" id="itemImage" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none" placeholder="https://example.com/image.jpg">
                        <p class="text-xs text-gray-500 mt-1">Paste a direct image link (use Unsplash, Imgur, etc.)</p>
                    </div>

                    <!-- Spice Level & Badge -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Spice Level</label>
                            <select id="itemSpice" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none">
                                <option value="1">üå∂Ô∏è Mild</option>
                                <option value="2" selected>üå∂Ô∏èüå∂Ô∏è Medium</option>
                                <option value="3">üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è Spicy</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Badge (Optional)</label>
                            <input type="text" id="itemBadge" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-[#D4AF37] focus:outline-none" placeholder="e.g. Bestseller">
                        </div>
                    </div>

                    <!-- Toggles -->
                    <div class="flex items-center gap-6 py-2">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="itemIsVeg" class="w-5 h-5 rounded border-gray-300 text-[#1B4332] focus:ring-[#1B4332]">
                            <span class="flex items-center gap-2">
                                <span class="w-4 h-4 border-2 border-green-600 rounded-sm flex items-center justify-center">
                                    <span class="w-2 h-2 bg-green-600 rounded-full"></span>
                                </span>
                                Vegetarian
                            </span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="itemAvailable" checked class="w-5 h-5 rounded border-gray-300 text-[#1B4332] focus:ring-[#1B4332]">
                            <span>Available</span>
                        </label>
                    </div>

                    <!-- Submit -->
                    <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-[#2CA58D] to-[#1F7F6D] text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 hover:shadow-xl transition-shadow">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span id="submitText">Save Item</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================================
         DELETE CONFIRM MODAL
         ============================================ -->
    <div id="deleteModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0 bg-black/60 flex items-center justify-center p-4" onclick="closeDeleteModal()">
            <div class="modal-content bg-white rounded-2xl w-full max-w-sm p-6 text-center" onclick="event.stopPropagation()">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center">
                    <i data-lucide="trash-2" class="w-8 h-8 text-red-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Delete Item?</h3>
                <p class="text-gray-600 mb-6" id="deleteItemName">Are you sure you want to delete this item?</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="flex-1 py-3 rounded-xl border-2 border-gray-200 font-medium hover:bg-gray-50">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" class="flex-1 py-3 rounded-xl bg-red-600 text-white font-medium hover:bg-red-700">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         TOAST CONTAINER
         ============================================ -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- ============================================
         FIREBASE SDK
         ============================================ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // ============================================
        // FIREBASE CONFIG
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAtmkVtNK_BlkGRSLWxlBtsjKymijlMhtY",
            authDomain: "alanati-telugu-kitchen.firebaseapp.com",
            projectId: "alanati-telugu-kitchen",
            storageBucket: "alanati-telugu-kitchen.appspot.com",
            messagingSenderId: "511397542426",
            appId: "1:511397542426:web:b0d6856ae4d45c6b716fa3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // ============================================
        // AUTH CHECK
        // ============================================
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "admin-login.html";
            } else {
                loadMenuItems();
            }
        });

        // ============================================
        // LOAD MENU ITEMS
        // ============================================
        let allItems = [];
        let deleteItemId = null;

        async function loadMenuItems() {
            try {
                const snapshot = await getDocs(collection(db, "menu"));
                allItems = [];
                snapshot.forEach(doc => {
                    allItems.push({ id: doc.id, ...doc.data() });
                });
                renderItems(allItems);
                updateStats();
            } catch (error) {
                console.error("Error loading menu:", error);
                document.getElementById("menuGrid").innerHTML = `
                    <div class="col-span-full text-center py-16 text-red-500">
                        <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-4"></i>
                        <p>Error loading menu items</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        function renderItems(items) {
            const grid = document.getElementById("menuGrid");
            
            if (items.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
                            <i data-lucide="utensils" class="w-10 h-10 text-gray-400"></i>
                        </div>
                        <p class="text-gray-500 mb-4">No menu items yet</p>
                        <button onclick="openAddModal()" class="text-[#D4AF37] font-medium hover:underline">
                            + Add your first item
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            grid.innerHTML = items.map(item => `
                <div class="menu-card bg-white rounded-2xl overflow-hidden shadow-lg" data-category="${item.category}">
                    <div class="h-40 bg-gradient-to-br from-[#D4AF37]/20 to-[#2CA58D]/20 relative">
                        <img src="${item.image || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop'}" 
                            alt="${item.name}" 
                            class="w-full h-full object-cover"
                            onerror="this.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop'">
                        
                        <!-- Veg/Non-Veg Indicator -->
                        <div class="absolute top-3 left-3 w-5 h-5 border-2 ${item.isVeg ? 'border-green-600' : 'border-red-600'} rounded flex items-center justify-center bg-white">
                            <span class="w-2.5 h-2.5 rounded-full ${item.isVeg ? 'bg-green-600' : 'bg-red-600'}"></span>
                        </div>
                        
                        <!-- Badge -->
                        ${item.badge ? `<div class="absolute top-3 right-3 bg-[#D4AF37] text-[#2CA58D] text-xs font-bold px-2 py-1 rounded">${item.badge}</div>` : ''}
                        
                        <!-- Availability -->
                        ${item.available === false ? `
                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                                <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold">Unavailable</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="p-4">
                        <div class="flex items-start justify-between gap-2 mb-2">
                            <h4 class="font-bold text-[#2CA58D] line-clamp-1">${item.name}</h4>
                            <span class="font-bold text-[#1B4332] whitespace-nowrap">‚Çπ${item.price}</span>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">${item.description || 'No description'}</p>
                        
                        <div class="flex items-center justify-between">
                            <span class="category-${item.category} text-xs font-bold px-2 py-1 rounded capitalize">${item.category}</span>
                            
                            <div class="flex gap-1">
                                <button onclick='editItem(${JSON.stringify(item).replace(/'/g, "\\'")})' 
                                    class="action-btn p-2 rounded-lg bg-blue-100 text-blue-600 hover:bg-blue-200" title="Edit">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>
                                <button onclick="toggleAvailability('${item.id}', ${item.available !== false})"
                                    class="action-btn p-2 rounded-lg ${item.available !== false ? 'bg-amber-100 text-amber-600 hover:bg-amber-200' : 'bg-green-100 text-green-600 hover:bg-green-200'}" 
                                    title="${item.available !== false ? 'Mark Unavailable' : 'Mark Available'}">
                                    <i data-lucide="${item.available !== false ? 'eye-off' : 'eye'}" class="w-4 h-4"></i>
                                </button>
                                <button onclick="openDeleteModal('${item.id}', '${item.name.replace(/'/g, "\\'")}')"
                                    class="action-btn p-2 rounded-lg bg-red-100 text-red-600 hover:bg-red-200" title="Delete">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function updateStats() {
            document.getElementById("totalItems").textContent = allItems.length;
            document.getElementById("availableItems").textContent = allItems.filter(i => i.available !== false).length;
            document.getElementById("vegItems").textContent = allItems.filter(i => i.isVeg).length;
            document.getElementById("nonVegItems").textContent = allItems.filter(i => !i.isVeg).length;
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        window.openAddModal = function() {
            document.getElementById("modalTitle").textContent = "Add Menu Item";
            document.getElementById("menuForm").reset();
            document.getElementById("itemId").value = "";
            document.getElementById("itemAvailable").checked = true;
            document.getElementById("menuModal").classList.remove("hidden");
        };

        window.editItem = function(item) {
            document.getElementById("modalTitle").textContent = "Edit Menu Item";
            document.getElementById("itemId").value = item.id;
            document.getElementById("itemName").value = item.name || "";
            document.getElementById("itemDescription").value = item.description || "";
            document.getElementById("itemPrice").value = item.price || "";
            document.getElementById("itemCategory").value = item.category || "";
            document.getElementById("itemImage").value = item.image || "";
            document.getElementById("itemSpice").value = item.spiceLevel || 2;
            document.getElementById("itemBadge").value = item.badge || "";
            document.getElementById("itemIsVeg").checked = item.isVeg || false;
            document.getElementById("itemAvailable").checked = item.available !== false;
            document.getElementById("menuModal").classList.remove("hidden");
        };

        window.closeModal = function() {
            document.getElementById("menuModal").classList.add("hidden");
        };

        window.saveItem = async function(event) {
            event.preventDefault();
            
            const id = document.getElementById("itemId").value;
            const data = {
                name: document.getElementById("itemName").value,
                description: document.getElementById("itemDescription").value,
                price: parseInt(document.getElementById("itemPrice").value),
                category: document.getElementById("itemCategory").value,
                image: document.getElementById("itemImage").value,
                spiceLevel: parseInt(document.getElementById("itemSpice").value),
                badge: document.getElementById("itemBadge").value,
                isVeg: document.getElementById("itemIsVeg").checked,
                available: document.getElementById("itemAvailable").checked,
                updatedAt: serverTimestamp()
            };

            const submitBtn = document.getElementById("submitBtn");
            const submitText = document.getElementById("submitText");
            submitBtn.disabled = true;
            submitText.textContent = "Saving...";

            try {
                if (id) {
                    await updateDoc(doc(db, "menu", id), data);
                    showToast("Item updated successfully!", "success");
                } else {
                    data.createdAt = serverTimestamp();
                    await addDoc(collection(db, "menu"), data);
                    showToast("Item added successfully!", "success");
                }
                closeModal();
                loadMenuItems();
            } catch (error) {
                console.error("Error saving:", error);
                showToast("Error saving item", "error");
            } finally {
                submitBtn.disabled = false;
                submitText.textContent = "Save Item";
            }
        };

        // ============================================
        // DELETE FUNCTIONS
        // ============================================
        window.openDeleteModal = function(id, name) {
            deleteItemId = id;
            document.getElementById("deleteItemName").textContent = `Delete "${name}"?`;
            document.getElementById("deleteModal").classList.remove("hidden");
        };

        window.closeDeleteModal = function() {
            document.getElementById("deleteModal").classList.add("hidden");
            deleteItemId = null;
        };

        window.confirmDelete = async function() {
            if (!deleteItemId) return;
            
            try {
                await deleteDoc(doc(db, "menu", deleteItemId));
                showToast("Item deleted", "success");
                closeDeleteModal();
                loadMenuItems();
            } catch (error) {
                console.error("Error deleting:", error);
                showToast("Error deleting item", "error");
            }
        };

        // ============================================
        // TOGGLE AVAILABILITY
        // ============================================
        window.toggleAvailability = async function(id, currentStatus) {
            try {
                await updateDoc(doc(db, "menu", id), { 
                    available: !currentStatus,
                    updatedAt: serverTimestamp()
                });
                showToast(currentStatus ? "Item marked unavailable" : "Item marked available", "success");
                loadMenuItems();
            } catch (error) {
                console.error("Error toggling:", error);
                showToast("Error updating item", "error");
            }
        };

        // ============================================
        // FILTER BY CATEGORY
        // ============================================
        window.filterCategory = function(category) {
            // Update button styles
            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.remove('bg-gray-100', 'text-gray-600');
                    btn.classList.add('bg-[#2CA58D]', 'text-white');
                } else {
                    btn.classList.remove('bg-[#2CA58D]', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-600');
                }
            });

            // Filter items
            if (category === 'all') {
                renderItems(allItems);
            } else {
                renderItems(allItems.filter(item => item.category === category));
            }
        };

        // ============================================
        // TOAST NOTIFICATION
        // ============================================
        window.showToast = function(message, type = "info") {
            const container = document.getElementById("toastContainer");
            const colors = {
                success: "bg-green-500",
                error: "bg-red-500",
                info: "bg-blue-500"
            };
            const icons = {
                success: "check-circle",
                error: "alert-circle",
                info: "info"
            };

            const toast = document.createElement("div");
            toast.className = `toast ${colors[type]} text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3`;
            toast.innerHTML = `
                <i data-lucide="${icons[type]}" class="w-5 h-5"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            lucide.createIcons();

            setTimeout(() => toast.remove(), 3000);
        };

        console.log("üî• Menu Management initialized");
    </script>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
